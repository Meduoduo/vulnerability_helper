from config import MONGO_DB, MONGO_HOST, MONGO_PASS, MONGO_PORT, MONGO_USER
from logger import Logger
from mongoengine import Document, connect

class MongoDBManager():
    database: Document = None

    def __init__(self, *args, **kwargs):
        '''
            Connect to MongoDB, host, port, username, password, database are required.
        '''
        super().__init__(*args, **kwargs)

    def connect(self, host: str, port: int, username: str, password: str, database: str):
        self.database = connect(
            db=database,
            host=host,
            port=port,
            username=username,
            password=password
        )
        Logger.info('Connected to MongoDB %s:%s/%s' % (host, port, database))

    def get_database(self):
        # check if database is connected
        if self.database is None:
            raise Exception('Database is not connected')
        # check if connection is alive
        if not self.database.connection.alive():
            raise Exception('Database connection is not alive')
        return self.database
    
    @staticmethod
    def get_instance():
        return MongoDBManager()

def mongo_connect():
    MongoDBManager().connect(MONGO_HOST, MONGO_PORT, MONGO_USER, MONGO_PASS, MONGO_DB)